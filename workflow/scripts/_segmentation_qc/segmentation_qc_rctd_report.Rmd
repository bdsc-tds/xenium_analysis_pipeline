---
params:
  gene_panel_id: "TO_BE_SET"
  file_path: "TO_BE_SET"

title: "Report: Segmentation QC based on RCTD for gene panel `r params$gene_panel_id`"
author: "Daria Buszta"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
library(Seurat)
library(arrow)
library(ggplot2)
library(dplyr)
```

```{r}
data <- read_parquet(params$file_path)
```

# Generate QC plots

number of cells

```{r, fig.height=7}

data$segmentation_id <- as.factor(data$segmentation_id)

ggplot(data, aes(x = sample, y = ncell, fill = segmentation_id)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme_minimal() +
  theme(
    axis.title = element_text(size = 26),       # Increase axis title font size
    axis.text = element_text(size = 24),        # Increase axis text font size
    legend.text = element_text(size = 24),      # Increase legend text font size
    plot.title = element_text(size = 28)        # Increase plot title font size
  ) +
  #scale_y_log10() +
  labs(title = NULL, y = "Number of Cells")

```

singlets

```{r, fig.height=7}

ggplot(data, aes(x = sample, y = singlet_prop, fill = segmentation_id)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme_minimal() +
  theme(
    axis.title = element_text(size = 26),       # Increase axis title font size
    axis.text = element_text(size = 24),        # Increase axis text font size
    legend.text = element_text(size = 24),      # Increase legend text font size
    plot.title = element_text(size = 28)        # Increase plot title font size
  ) +
  #scale_y_log10() +
  labs(title = NULL, y = "% of Singlets")

```

rejects

```{r, fig.height=7}

ggplot(data, aes(x = sample, y = reject_prop, fill = segmentation_id)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme_minimal() +
  theme(
    axis.title = element_text(size = 26),       # Increase axis title font size
    axis.text = element_text(size = 24),        # Increase axis text font size
    legend.text = element_text(size = 24),      # Increase legend text font size
    plot.title = element_text(size = 28)        # Increase plot title font size
  ) +
  #scale_y_log10() +
  labs(title = NULL, y = "% of Rejects")

```

mean_nCount

```{r, fig.height=7}

ggplot(data, aes(x = sample, y = mean_ncount, fill = segmentation_id)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme_minimal() +
  theme(
    axis.title = element_text(size = 26),       # Increase axis title font size
    axis.text = element_text(size = 24),        # Increase axis text font size
    legend.text = element_text(size = 24),      # Increase legend text font size
    plot.title = element_text(size = 28)        # Increase plot title font size
  ) +
  #scale_y_log10() +
  labs(title = NULL, y = "mean_nCount")

```

mean_nFeature

```{r, fig.height=7}

ggplot(data, aes(x = sample, y = mean_nfeature, fill = segmentation_id)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme_minimal() +
  theme(
    axis.title = element_text(size = 26),       # Increase axis title font size
    axis.text = element_text(size = 24),        # Increase axis text font size
    legend.text = element_text(size = 24),      # Increase legend text font size
    plot.title = element_text(size = 28)        # Increase plot title font size
  ) +
  #scale_y_log10() +
  labs(title = NULL, y = "mean_nFeature")

```
